# uTools 插件版本说明

## ✨ 纯前端版本 - 无需后端服务！

这是一个完全在浏览器中运行的版本，**不需要启动任何后端服务**，所有逻辑都在前端 JavaScript 中实现。

## 项目结构

```
utools_plugin/
├── plugin.json          # uTools 插件配置文件
├── index.html           # 插件主界面
├── preload.js          # 插件预加载脚本
├── distance.js          # 距离计算模块（JavaScript）
├── amap_api.js          # 高德地图API封装（JavaScript）
├── cluster_finder.js    # 商圈查找算法（JavaScript）
├── output.js            # HTML地图生成（JavaScript）
└── README.md           # 说明文档
```

## 功能特点

✅ **纯前端实现** - 所有逻辑都在浏览器中运行  
✅ **无需后端** - 不需要启动任何服务器  
✅ **即开即用** - 配置好 API 密钥即可使用  
✅ **自动打开地图** - 结果自动在新窗口打开  

## 使用步骤

### 1. 配置插件

1. 在 uTools 中创建新插件
2. 将 `plugin.json` 配置到插件
3. 设置 `index.html` 为主入口
4. 设置 `preload.js` 为预加载脚本
5. 将所有 JS 文件放在同一目录

### 2. 配置 API 密钥

1. 打开插件界面
2. 点击"设置"按钮
3. 输入高德地图 API 密钥
4. 密钥会保存在 uTools 的本地存储中

### 3. 使用插件

1. 在 uTools 中输入 "商圈" 或 "商圈查找"
2. 打开插件界面
3. 输入城市名称（如：北京、上海、深圳）
4. 输入品牌列表，用逗号分隔（如：优衣库,海底捞,星巴克）
5. 设置距离阈值（默认 200 米）
6. 点击"查找商圈"
7. 等待处理完成，地图会自动在新窗口打开

## 技术实现

### 核心模块

1. **distance.js** - Haversine 距离计算
2. **amap_api.js** - 高德地图 API 调用（使用 fetch）
3. **cluster_finder.js** - 商圈查找算法（空间索引优化）
4. **output.js** - HTML 地图生成

### 工作流程

```
用户输入 → 搜索品牌门店 → 构建空间索引 → 查找商圈 → 生成HTML地图 → 打开地图
```

## API 密钥配置

插件使用 uTools 的本地存储功能保存 API 密钥：

- 点击"设置"按钮输入密钥
- 密钥保存在 `utools.dbStorage` 中
- 下次打开插件自动加载

## 注意事项

1. **跨域问题**: 高德地图 API 需要在控制台配置允许的域名
   - 如果遇到跨域问题，可以在高德开放平台配置白名单
   - 或者使用代理服务器

2. **性能**: 
   - 对于大量门店（>1000），查找可能需要一些时间
   - 算法已使用空间索引优化，性能较好

3. **浏览器兼容性**:
   - 需要支持 ES6+ 的现代浏览器
   - 需要支持 fetch API

## 优势

- ✅ **零配置** - 不需要安装 Python、不需要启动服务
- ✅ **便携性** - 所有代码都在前端，易于分发
- ✅ **响应快** - 无需网络请求到本地服务器
- ✅ **易维护** - 纯 JavaScript，易于调试和修改

## 故障排除

### 问题：无法搜索门店

**解决方案**:
1. 检查 API 密钥是否正确配置
2. 检查网络连接
3. 查看浏览器控制台的错误信息

### 问题：跨域错误

**解决方案**:
1. 在高德开放平台配置允许的域名
2. 或者使用浏览器扩展禁用 CORS（仅开发测试）

### 问题：查找速度慢

**解决方案**:
1. 减少品牌数量
2. 增加距离阈值
3. 检查浏览器控制台是否有错误

## 开发说明

所有核心逻辑都已转换为 JavaScript：
- Python 的 `itertools.product` → JavaScript 生成器函数
- Python 的字典 → JavaScript 对象
- Python 的列表推导式 → JavaScript 的 map/filter

算法逻辑保持一致，性能也经过优化。

